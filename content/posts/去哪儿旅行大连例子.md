---
title: "pythonçˆ¬å–å»å“ªå„¿æ—…è¡Œæ™¯ç‚¹ä¿¡æ¯â€”ä»¥å¤§è¿ä¸ºä¾‹"
date: 2022-05-01T23:46:51+08:00
timezone: "UTC+8"
tags: ['ğŸ·ï¸Python', 'ğŸ·ï¸çˆ¬è™«']
categories: ['Python']
description: ''
draft: false
cover: "/images/16.jpg"
toc: true
grow: large
aplayer: true
dplayer: true
math: true
---

å‰è¨€
---
æœ¬æ–‡æœ€å…ˆå‘å¸ƒäºåƒåœ¾CSDNï¼Œåç»­æ›´æ”¹ä¸€æ¬¡åå§‹ç»ˆé€šè¿‡ä¸äº†ç‰ˆæƒå®¡æ ¸~~å°±æ˜¯æƒ³é€¼æˆ‘ä¸è¡¨æ˜åŸåˆ›~~ï¼Œè™½ç„¶å·²ç»å¤±æ•ˆï¼Œä½†è¿˜æ˜¯è´¼æ°”ï¼Œæ‰€ä»¥è¿™ä¹Ÿæ˜¯ä¿ƒæˆæˆ‘å»ºç«‹æœ¬åšå®¢çš„åŸå› ä¹‹ä¸€ã€‚

æ­£æ–‡
---

**2022/4/11æ›´æ–° çˆ¬è™«å·²ç»å¤±æ•ˆï¼Œä»…ä¾›å‚è€ƒå­¦ä¹ ï¼ˆrequestsè¯·æ±‚åè¿”å›ä¸º404,å¹¶æ²¡æœ‰è·å¾—æ­£ç¡®çš„æºç ï¼‰**

å› æŠ€æœ¯æœ‰é™ï¼Œä»¥è‡³äºå­˜åœ¨ä¸å°‘çº°æ¼ï¼ˆä¸‹æ–‡ä»£ç ä¸­ä¼šè¯¦ç»†è¯´æ˜ï¼‰ï¼Œè¿˜è¯·å¤šå¤šåŒ…æ¶µï¼Œå¸Œæœ›çœ‹åˆ°çš„å¤§ä½¬å¸¦å¸¦æˆ‘è¿™ä¸ªèœé¸¡è§£å†³ï¼Œå…ˆåœ¨æ­¤æ„Ÿè°¢äº†

æœ¬æ–‡å±äºè¡¥å…¨ä»£ç ï¼ŒåŸæ–‡è¿æ¥å¦‚ä¸‹ï¼Œå¯¹æ­¤æˆ‘åªæƒ³è¯´ï¼Œæ°é¥­æ²¡é”™ï¼Œä½†æ˜¯è¿™æ ·çš„å¼•æµç¡®å®è†ˆåº”äºº[Pythonçˆ¬å–å»å“ªäº†æ—…æ¸¸æ™¯ç‚¹æ•°æ®_ã€CSDNå®˜æ–¹æ¨èã€‘-CSDNåšå®¢](https://blog.csdn.net/m0_48405781/article/details/109346030)

# å¯¼å…¥åº“å‡½æ•°
``` python
import requests
import parsel
from parsel import Selector
from time import sleep
from random import random
import pandas as pd
import numpy as np
```
# å®Œæ•´ä»£ç 
```python
myheader = {"user-agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.54 Safari/537.36"
           } #æŒ‚è¯·æ±‚å¤´
fout = open('å»å“ªå„¿æ—…è¡Œ-å¤§è¿æ™¯ç‚¹ä¿¡æ¯1.txt','w',encoding='utf-8')#å»ºç«‹txtæ–‡ä»¶å­˜å‚¨
for page in range(1,41):#æ„å»ºé¡µé¢å¾ªç¯
    url = f'https://piao.qunar.com/ticket/list_%E5%A4%A7%E8%BF%9E.html?from=mps_search_suggest_h&keyword=%E5%A4%A7%E8%BF%9E&page={page}'
    sleep(2*random())
    response = requests.get(url=url, headers=myheader)
    per=Selector(response.text)
    result=per.css('#search-list')
    try:
        for i in range(1,16):#å¾ªç¯æŸ¥å–æ¯é¡µå†…çš„æ‰€éœ€å€¼
#             li=result.css(f'#search-list > div:nth-child({i})')     æ­¤å¤„å’Œä¸‹é¢ä»£ç ä½œç”¨ç›¸åŒï¼Œéƒ½ä¸ºå®šä½åˆ°åŒ…å«çˆ¬å–ä¿¡æ¯çš„çˆ¶æ ‡ç­¾
            li=result.xpath(f'//*[@id="search-list"]/div[{i}]')       #ä¸Šé¢ä½¿ç”¨äº†Selectorå¯¹è±¡è¿›è¡Œå®šä½ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯Xpathç›¸å¯¹è·¯å¾„ï¼Œå¯èƒ½ä¹Ÿæ˜¯å› ä¸ºè¿™ä¸ªæ‰€ä»¥å¯¼è‡´çˆ¬å–ä¿¡æ¯ä¸å®Œæ•´ï¼Œ
            sleep(2*random())                                         #æ¥ä¸Šæ–‡ï¼šä¸ªäººç›²çŒœåŒ…å«ä¿¡æ¯çš„çˆ¶æ ‡ç­¾æ˜¯åŠ¨æ€çš„ï¼Œæ‰€ä»¥å¯¼è‡´æœ‰çš„é¡µé¢æ— æ³•æœ‰æ•ˆçˆ¬å–ï¼Œå¸Œæœ›çœ‹åˆ°çš„çš„å¤§ä½¬å¯ä»¥è¿›è¡Œæ”¹è¿›
            title = li.css('.sight_item_caption a::attr(title)').get()  # æ™¯åŒºåå­—
            level = li.css('.sight_item_info .level::text').get()   # æ™¯åŒºç­‰çº§
            area = li.css('.area a::attr(title)').get()     # åœ°åŒº
            address = li.css('.address span::attr(title)').get()  # åœ°å€
            string = li.css('.product_star_level em::attr(title)').get()    # çƒ­åº¦
            star_level = float(string.strip('çƒ­åº¦: '))
            intro = li.css('.intro::attr(title)').get()  # ç®€ä»‹
            price = li.css('.sight_item_price em::text').get()   # ä»·æ ¼
            hot_num = li.css('.hot_num::text').get()  # æœˆé”€
            print(title,level,area, address,star_level,intro,price, hot_num,sep='#',file=fout)#æ‰“å°æ¯ä¸ªæ™¯ç‚¹å„ä¸ªä¿¡æ¯ï¼Œä»¥"#"å·éš”å¼€å¹¶å­˜å–åˆ°txtæ–‡ä»¶ä¸­
    except : #1.æœ‰çš„æ²¡æœ‰æ™¯åŒºçƒ­åº¦æ‰€ä»¥ä½¿ç”¨tryå‡½æ•°æŠ›å‡ºäº†å¼‚å¸¸ 2.æŠ›å‡ºäº†äº†ä¸Šé¢å› ä¸ºçˆ¶æ ‡ç­¾æ„å»ºçˆ¬å–åˆ°çš„ä¿¡æ¯
            sleep(1*random()) #éšæœºä¼‘çœ ä¼ªè£…ä¸€ä¸‹
    print(f'-------ç¬¬{page:02}é¡µçˆ¬å–å®Œæˆ------')
fout.close()
#pandaså…„yydsï¼Œæœ€åéœ€è¦excelæ‰€ä»¥é‡æ–°è¯»å–å¦å­˜äº†xlsxæ–‡ä»¶
df = pd.read_csv('å»å“ªå„¿æ—…è¡Œ-å¤§è¿æ™¯ç‚¹ä¿¡æ¯.txt',sep='#',
                 names=['æ™¯åŒºåå­—','æ™¯åŒºç­‰çº§','åœ°åŒº',
                        'åœ°å€','çƒ­åº¦','ç®€ä»‹','ä»·æ ¼','æœˆé”€'])
df.to_excel('å»å“ªå„¿æ—…è¡Œ-å¤§è¿æ™¯ç‚¹ä¿¡æ¯.xlsx',index=False)
print('-------æå®Œç¡è§‰ï¼Œæ²¡æ„æ€äº†-------')
```

# è¿è¡Œç»“æœ
![ç»“æœ1](https://img-blog.csdnimg.cn/20210924113327612.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAWW9rZWFnb25p,size_20,color_FFFFFF,t_70,g_se,x_16)
![ç»“æœ2](https://img-blog.csdnimg.cn/20210924113336361.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAWW9rZWFnb25p,size_20,color_FFFFFF,t_70,g_se,x_16)








<div>
<div> è‘—ä½œæƒå½’ä½œè€…Yokeæ‰€æœ‰ã€‚</div>
<div> å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</div>    
<div>æ¥æº <a target="_blank" href="www.yoke.ink"> Â© Yoke's Blog </a></div>  
 <div class="copyright-text">ä½œå“é‡‡ç”¨ <a class="text-decoration-none" target="_blank" href="https://creativecommons.org/licenses/by/4.0/deed.zh">
 çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®® </a>è¿›è¡Œè®¸å¯ </div></div>